<?php
require_once __DIR__.'/includes/db.php';
require_once __DIR__.'/includes/header.php';

$id = isset($_GET['id']) ? (int)$_GET['id'] : 0;
$stmt = $pdo->prepare('SELECT p.*, c.name as category_name FROM products p LEFT JOIN categories c ON p.category_id=c.id WHERE p.id = ?');
$stmt->execute([$id]);
$p = $stmt->fetch(PDO::FETCH_ASSOC);
if(!$p) {
    echo '<p>Product not found.</p>';
    require_once __DIR__.'/includes/footer.php';
    exit;
}
?>
<div class="product-detail">
  <img src="<?= $p['image'] ? '/uploads/'.htmlspecialchars($p['image']) : '/assets/images/placeholder.png' ?>" alt="<?=htmlspecialchars($p['name'])?>">
  <h2><?=htmlspecialchars($p['name'])?></h2>
  <p class="price">$<?=number_format($p['price'],2)?></p>
  <p><?=nl2br(htmlspecialchars($p['description']))?></p>
  <p>Category: <?=htmlspecialchars($p['category_name'])?></p>
<form method="post" action="/add_to_cart.php">
  <input type="hidden" name="product_id" value="<?=$p['id']?>">
  <label>Quantity <input type="number" name="quantity" value="1" min="1"></label>
  <button type="submit">Add to Cart</button>
</form>
</div>
<?php require_once __DIR__.'/includes/footer.php'; ?>